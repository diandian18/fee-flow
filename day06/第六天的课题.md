# 部署client部分，串起整体流程

**环境：**

- win10物理机
- Wmare Centos7虚拟机C

## 1. client

### 1.1 修改`fee-client`

- 在fee项目中，配置ajax请求前缀

    ```js
    // client\config\url.js
    const PRO_URL = '/server-api'
    ```

### 1.2 安装`fee-client`依赖

- 在fee项目中，cd到client，安装依赖

    ```bash
    npm i --registry=https://registry.npm.taobao.org
    ```

- 编译client

    ```bash
    npm run build
    ```

### 1.3 部署`fee-client`

- 在虚拟机A新建目录

    ```bash
    mkdir -p /home/admin/fee-client
    ```

- 把编译好的dist目录发送到虚拟机A

    ```bash
    scp -r dist/* root@192.168.199.153:/home/admin/fee-client
    ```

### 1.4 配置和重启nginx

- 在虚拟机A配置nginx

    ```shell
    # /etc/nginx/nginx.conf
     server {
        listen       3333;
        server_name  fee-client;
        location / {
            root /home/admin/fee-client;
            try_files $uri /index.html;
        }
        location /server-api/ {
            proxy_pass http://192.168.199.217:3000/;
        }
    }
    ```

- 重启nginx

    ```bash
    systemctl restart nginx
    ```

### 1.5 注册client用户

- 浏览器访问client `http://192.168.199.153:3333/`

- 注册一个账号

### 1.6 修改fee数据库

- 在虚拟机C，进入fee数据库

    ```bash
    mysql -u root -p
    # 密码qweQWE123!@#
    use fee
    ```

- 修改`t_o_user`表中，刚才注册账号的role字段

    ```shell
    UPDATE `fee`.`t_o_user` SET `role` = 'owner' WHERE `id` = 1
    ```

### 1.6 访问client

- 访问`http://localhost:8080/`，手动制造一些错误

- 浏览器访问`http://192.168.199.153:3333/`，我们可以看到菜单

    - 用户行为

        - 菜单点击量
        - 用户在线时长
        - 新增用户数据

    - 异常监控

        - 页面性能
        - 错误看板

    - 报警

        - 配置 `SET @@global.sql_mode= '';否则报错`
        - 日志

- 我们打开错误看板菜单，可以查看发生过的所有错误信息
- 我们打开页面性能菜单，可以看到url对应的页面加载时间详情、页面加载瀑布图信息
